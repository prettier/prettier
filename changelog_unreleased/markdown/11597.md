#### [BREAKING] No more inserting space between Chinese or Japanese (e.g. hanzi and kana) and western characters (#11597 by @tats-u)

The current behavior of inserting whitespace (U+0020) between Chinese or Japanese (e.g. hanzi/kanji and kana) and western (e.g. alphanumerics) characters is not based on the official layout guidelines in Japanese and Chinese but [non-standard and local one in Chinese](https://github.com/ruanyf/document-style-guide/blob/master/docs/text.md).

Official Japanese guideline (W3C):

> 3.9.1 Differences in Positioning of Characters and Symbols
>
> The positioning of characters and symbols may vary depending on the following.
>
> d. Are characters and symbols appearing in sequence in solid setting, or will there be a fixed size space between them? For example, sequences of ideographic characters (cl-19) and hiragana (cl-15) are set solid, and for Western characters (cl-27) following hiragana (cl-15) there will be quarter em spacing.

<https://www.w3.org/TR/jlreq/#differences_in_positioning_of_characters_and_symbols>

> â€œone quarter emâ€ means one quarter of the full-width size. (JIS Z 8125)  
> â€œone quarter em spaceâ€ means amount of space that is one quarter size of em space.

<https://www.w3.org/TR/jlreq/#term.quarter-em>  
<https://www.w3.org/TR/jlreq/#term.quarter-em-space>

Official Japanese guideline (JIS X 4051:2004):

> 4.7 å’Œæ¬§æ–‡æ··æ¤å‡¦ç†
>
> a) æ¨ªæ›¸ãã§ã¯ï¼Œå’Œæ–‡ã¨æ¬§æ–‡ã¨ã®é–“ã®ç©ºãé‡ã¯ï¼Œå››åˆ†ã‚¢ã‚­ã‚’åŸå‰‡ã¨ã™ã‚‹ã€‚
>
> 4.7 Mixed Japanese and Western Text Composition
>
> a) In horizontal writing, the space between Japanese and western text should be one quarter em, as a rule.
>
> PR Author's Note: Original text is written only in Japanese and translation is based on [DeepL](https://www.deepl.com/translator).

<https://kikakurui.com/x4/X4051-2004-02.html> (Japanese)

Official Chinese guideline (W3C):

> 3.2.2 Mixed Text Composition in Horizontal Writing Mode
>
> In principle, there is tracking or spacing between an adjacent Han character and a Western character of up to one quarter of a Han character width, except at the line start or end.
>
> NOTE: Another approach is to use a Western word space (U+0020 SPACE), in which case the width depends on the font in use.

<https://www.w3.org/TR/clreq/#mixed_text_composition_in_horizontal_writing_mode>

As mentioned above, whitespace (U+0020) is allowed to be substituted for one quarter em only in Chinese, although they have a similar appearance. Also, even in Chinese, the rule is not adopted even in the W3C guideline page but is mentioned as just one of the options.

Some renderers (e.g. convert to PDF using Pandoc with the backend of LaTeX) can automatically insert genuine one quarter em. The width of whitespace is different from one quarter em, so inserting whitespace (U+0020) takes away the option to leave it to renderers to insert one quarter em. Adding space should be left to renderers and should not be done by Prettier, just a formatter.

<!-- prettier-ignore -->
Adding whitespace may interfere with searches for text containing both Chinese or Japanese and western characters. For example, you cannot find â€œç¬¬1ç« â€ (Chapter 1) in a Markdown document or its derivative just by searching by the string â€œç¬¬1ç« â€ but â€œç¬¬ 1 ç« â€.

To make matters worst, once whitespace is inserted, it is difficult to remove it. The following sentence cannot be said to be wrong.

> ä½œã‚‹ means make in Japanese.

The too simple rule of removing whitespace between Chinese or Japanese characters and alphanumerics removes that between â€œä½œã‚‹â€ and â€œmeansâ€ unless you modify the sentence, that is, quote â€œä½œã‚‹â€. It is so difficult to create a common rule that can safely remove whitespace from all documents and deserves to be included in Prettier.

For these reasons, we stopped inserting space.

<!-- prettier-ignore -->
```markdown
<!-- Input -->
æ¼¢å­—Alphabetsã²ã‚‰ãŒãª12345ã‚«ã‚¿ã‚«ãƒŠ67890í•œê¸€

æ¼¢å­— Alphabets ã²ã‚‰ãŒãª 12345 ã‚«ã‚¿ã‚«ãƒŠ 67890 í•œê¸€

<!-- Prettier stable -->
æ¼¢å­— Alphabets ã²ã‚‰ãŒãª 12345 ã‚«ã‚¿ã‚«ãƒŠ 67890í•œê¸€

æ¼¢å­— Alphabets ã²ã‚‰ãŒãª 12345 ã‚«ã‚¿ã‚«ãƒŠ 67890 í•œê¸€

<!-- Prettier main -->
æ¼¢å­—Alphabetsã²ã‚‰ãŒãª12345ã‚«ã‚¿ã‚«ãƒŠ67890í•œê¸€

æ¼¢å­— Alphabets ã²ã‚‰ãŒãª 12345 ã‚«ã‚¿ã‚«ãƒŠ 67890 í•œê¸€
```

This change includes the following breaking changes:

##### 1. Comply to line breaking rules in Chinese and Japanese

In Chinese and Japanese, some characters (e.g. full stop characters `ã€‚`, `ï¼`, and `.`) are not allowed to be placed the head or tail of lines.

- Japanese: <https://www.w3.org/TR/jlreq/#characters_not_starting_a_line>
- Chinese: <https://www.w3.org/TR/clreq/#prohibition_rules_for_line_start_end>

ğŸ‘Bad:

```text
æ—¥æœ¬èªçµ„ç‰ˆã«ã¯
ã€ç¦å‰‡å‡¦ç†ï¼ˆ
ãã‚“ããã—ã‚‡ã‚Š
ï¼‰ã¨å‘¼ã°ã‚Œã‚‹ãƒ«
ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™
ã€‚
```

ğŸ‘Good:

```text
æ—¥æœ¬èªçµ„ç‰ˆã«
ã¯ã€ç¦å‰‡å‡¦ç†
ï¼ˆãã‚“ããã—ã‚‡
ã‚Šï¼‰ã¨å‘¼ã°ã‚Œã‚‹
ãƒ«ãƒ¼ãƒ«ãŒã‚ã‚Šã¾
ã™ã€‚
```

In the above sentence:

- `ã€`, `ï¼‰`, `ãƒ¼`, `ã‚‡`, and `ã€‚` must not be placed in the head of lines.
- `ï¼ˆ` must not be placed in the tail of lines.

##### 2. Do not break lines inside Korean words

This fixes #6516. Korean uses space to divide words or clauses, and inappropriate words (or clauses) divisions may change the meanings of sentences.

- `ë…¸ë˜ë¥¼ ëª»í•´ìš”.`: I'm not good at singing.
- `ë…¸ë˜ë¥¼ ëª» í•´ìš”.`: I can't sing (for some reason).

Applying this patch, when `proseWrap` is other than `preserve`, Korean sentences are now formatted like those of European languages; successive (i.e. not divided by space) Hangul characters are no longer divided by the newline (U+000A), which may be converted to the space (U+0020) when the content of the document is modified.

`proseWrap` = `always` & `printWidth` = `9`:

Input:

```text
ë…¸ë˜ë¥¼ ëª»í•´ìš”.
```

Before this patch:

```text
ë…¸ë˜ë¥¼ ëª»
í•´ìš”.
```

ğŸ‘Reformat â€œBefore this patchâ€ with `printWidth` = `80`:

```text
ë…¸ë˜ë¥¼ ëª» í•´ìš”.
```

After this patch:

```text
ë…¸ë˜ë¥¼
ëª»í•´ìš”.
```

ğŸ‘Reformat â€œAfter this patchâ€ with `printWidth` = `80`:

```text
ë…¸ë˜ë¥¼ ëª»í•´ìš”.
```
